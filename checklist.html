<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Checklist - Ambiente Espiritual</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#F5F2E9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ambiente Espiritual">
  <link rel="stylesheet" href="./design-tokens.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    .checkbox-item { display: flex; gap: var(--spacing-md); align-items: flex-start; margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: rgba(200,176,138,0.05); border-radius: var(--radius-md); border-left: 3px solid var(--c-dourado-suave); }
    .checkbox-item input[type="checkbox"] { margin-top: 4px; }
    .checkbox-item input[type="checkbox"]:checked { accent-color: var(--c-azul-marinho); }
  </style>
</head>
<body>
  <main class="app-container">
    <!-- Header -->
    <div class="mb-xl">
      <h1>Sua Jornada Espiritual</h1>
      <p class="text-apoio">Acompanhe seu progresso atrav√©s dos passos essenciais</p>
      <div class="progress-container mt">
        <div id="progressBar" class="progress-bar-track">
          <div id="progressFill"class="progress-bar-fill" style="width: 0%"></div>
        </div>
        <p id="progressText" class="progress-text">0 de 9 tarefas conclu√≠das</p>
      </div>
    </div>

    <!-- Checklist por Se√ß√£o -->
    <div class="card-elohim">
      <h3>Espa√ßo F√≠sico</h3>
      <div class="checkbox-item">
        <input type="checkbox" id="check1" class="checklist-checkbox">
        <label for="check1">Escolher um local espec√≠fico na casa</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="check2" class="checklist-checkbox">
        <label for="check2">Limpar e organizar o espa√ßo</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="check3" class="checklist-checkbox">
        <label for="check3">Colocar a B√≠blia no local</label>
      </div>
    </div>

    <div class="card-elohim">
      <h3>Rotina Espiritual</h3>
      <div class="checkbox-item">
        <input type="checkbox" id="check4" class="checklist-checkbox">
        <label for="check4">Definir hor√°rio para ora√ß√£o matinal</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="check5" class="checklist-checkbox">
        <label for="check5">Definir pausa do meio-dia</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="check6" class="checklist-checkbox">
        <label for="check6">Definir reflex√£o noturna</label>
      </div>
    </div>

    <div class="card-elohim">
      <h3>Controle Digital</h3>
      <div class="checkbox-item">
        <input type="checkbox" id="check7" class="checklist-checkbox">
        <label for="check7">Configurar Modo Silencioso autom√°tico</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="check8" class="checklist-checkbox">
        <label for="check8">Baixar app espiritual (B√≠blia, medita√ß√£o)</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="check9" class="checklist-checkbox">
        <label for="check9">Bloquear redes sociais ap√≥s as 20h</label>
      </div>
    </div>

    <!-- A√ß√µes -->
    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
      <button class="btn btn-primario" style="width: 100%;" onclick="downloadPDF()">
        <span class="material-symbols-outlined">download</span> Baixar Checklist em PDF
      </button>
      <button class="btn btn-secundario" style="width: 100%;" onclick="limparProgresso()">
        <span class="material-symbols-outlined">refresh</span> Limpar Progresso
      </button>
    </div>
  </main>

  <!-- Bottom Navigation Bar -->
  <nav class="bottom-bar">
    <button class="btn btn-secundario" onclick="window.location='./index.html'">
      <span class="material-symbols-outlined">home</span> Capa
    </button>
    <button class="btn btn-primario" onclick="window.location='./wallpapers.html'">
      Wallpapers <span class="material-symbols-outlined">arrow_forward</span>
    </button>
  </nav>

  <script>
    // üßπ LIMPEZA AGRESSIVA v4 ao carregar checklist
    (async function aggressiveClearup() {
      try {
        const cacheNames = await caches.keys();
        for (const name of cacheNames) {
          if (name !== 'ambiente-espiritual-v4') {
            await caches.delete(name);
          }
        }
      } catch (error) {
        console.error('Erro ao limpar cache:', error);
      }
    })();

    const STORAGE_KEY = 'ambiente-espiritual-checklist';

    // Atualizar progress bar
    function atualizarProgresso() {
      const checkboxes = document.querySelectorAll('.checklist-checkbox');
      const checados = Array.from(checkboxes).filter(cb => cb.checked).length;
      const total = checkboxes.length;
      const porcentagem = (checados / total) * 100;

      document.getElementById('progressFill').style.width = porcentagem + '%';
      document.getElementById('progressText').textContent = `${checados} de ${total} tarefas conclu√≠das`;

      // Salvar localStorage
      const estado = {};
      checkboxes.forEach((cb, index) => {
        estado[`check${index + 1}`] = cb.checked;
      });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(estado));
    }

    // Carregar progresso ao abrir p√°gina
    function carregarProgresso() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        const estado = JSON.parse(saved);
        Object.keys(estado).forEach(key => {
          const checkbox = document.getElementById(key);
          if (checkbox) checkbox.checked = estado[key];
        });
      }
      atualizarProgresso();
    }

    // Baixar PDF
    function downloadPDF() {
      const element = document.querySelector('.app-container');
      const opt = {
        margin: 10,
        filename: 'Checklist-Ambiente-Espiritual.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
      };
      html2pdf().set(opt).from(element).save();
    }

    // Limpar progresso
    function limparProgresso() {
      if (confirm('Tem certeza que deseja limpar o progresso? Esta a√ß√£o n√£o pode ser desfeita.')) {
        document.querySelectorAll('.checklist-checkbox').forEach(cb => cb.checked = false);
        localStorage.removeItem(STORAGE_KEY);
        
        // Limpar tamb√©m qualquer localStorage antigas
        const allKeys = Object.keys(localStorage);
        allKeys.forEach(key => {
          if (key.includes('checklist') || key.includes('ambiente')) {
            localStorage.removeItem(key);
          }
        });
        
        atualizarProgresso();
        console.log('‚úÖ Progresso completamente limpo');
      }
    }

    // Event listeners
    document.querySelectorAll('.checklist-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', atualizarProgresso);
    });

    // Carregar ao abrir
    window.addEventListener('DOMContentLoaded', carregarProgresso);

    // Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>
</body>
</html>