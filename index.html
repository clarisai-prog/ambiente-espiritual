<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Ambiente Espiritual - Capa</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#F5F2E9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ambiente Espiritual">
  <link rel="stylesheet" href="./design-tokens.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
</head>
<body>
  <main class="app-container">
    <!-- Header com Progresso -->
    <div class="text-center mb mb-xl">
      <h1>Ambiente Espiritual</h1>
      <p class="text-apoio">Arrume a Casa para Deus Entrar</p>
      <div class="progress-container mt">
        <div class="progress-bar-track">
          <div class="progress-bar-fill" style="width: 20%"></div>
        </div>
        <p class="progress-text">1 de 5 etapas</p>
      </div>
    </div>

    <!-- Conte√∫do Principal -->
    <div class="card-elohim">
      <p class="text-apoio">
        "Muitas vezes, nossa vida de ora√ß√£o n√£o avan√ßa por um motivo simples: o ambiente n√£o ajuda. A casa est√° barulhenta, o celular n√£o para de apitar, n√£o temos um lugar para ficar em sil√™ncio."
      </p>
      <p style="margin-top: var(--spacing-md); font-weight: 600;">
        Hoje vamos resolver isso juntos.
      </p>
    </div>

    <!-- V√≠deo Introdut√≥rio -->
    <div class="card-elohim">
      <div style="aspect-ratio: 16/9; background: var(--c-azul-marinho); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; margin-bottom: var(--spacing-md);">
        <span class="material-symbols-outlined" style="font-size: 64px; color: var(--c-dourado-suave);">play_circle</span>
      </div>
      <p style="font-size: 0.875rem; color: var(--c-texto-apoio);">
        <strong>Introdu√ß√£o</strong> ‚Ä¢ 01:00
      </p>
    </div>

    <!-- Informa√ß√µes Gerais -->
    <div class="card-elohim">
      <h3 style="color: var(--c-azul-marinho); font-size: 1.5rem;">Sobre este guia</h3>
      <p class="text-apoio">
        Um programa pr√°tico e espiritual de 5 etapas para transformar seu espa√ßo e sua rotina em um santu√°rio de ora√ß√£o. Atrav√©s de t√©cnicas simples e reflex√µes profundas, voc√™ aprender√° a:
      </p>
      <ul style="color: var(--c-texto-apoio); margin-left: 1.5rem; margin-bottom: var(--spacing-md);">
        <li>‚úì Preparar um Canto Sagrado dedicado √† ora√ß√£o</li>
        <li>‚úì Estabelecer uma Rotina que Liberta</li>
        <li>‚úì Usar o Celular a Favor da Espiritualidade</li>
        <li>‚úì Revisar e Consolidar seu Aprendizado</li>
      </ul>
    </div>

    <!-- A√ß√µes Principais -->
    <div style="display: flex; flex-direction: column; gap: var(--spacing-md); margin-bottom: 80px;">
      <button class="btn btn-primario" style="width: 100%;" onclick="window.location='./parte-2.html'">
        Iniciar Tutorial ‚Üí
      </button>
      <button class="btn btn-secundario" style="width: 100%;" onclick="window.location='./checklist.html'">
        <span class="material-symbols-outlined">checklist</span> Meu Progresso
      </button>
      <button class="btn btn-secundario" style="width: 100%;" onclick="window.location='./wallpapers.html'">
        <span class="material-symbols-outlined">image</span> Inspira√ß√£o
      </button>
    </div>
  </main>

  <!-- Bottom Navigation Bar -->
  <nav class="bottom-bar">
    <button class="btn btn-secundario" onclick="window.location='./index.html'">
      <span class="material-symbols-outlined">home</span> Capa
    </button>
    <button class="btn btn-primario" onclick="window.location='./parte-2.html'">
      Iniciar <span class="material-symbols-outlined">arrow_forward</span>
    </button>
  </nav>

  <script>
    // üßπ LIMPEZA AGRESSIVA: Cache + localStorage + dados antigos
    (async function aggressiveClearup() {
      console.log('üßπ == INICIANDO LIMPEZA AGRESSIVA v4 == üßπ');
      
      // 1. Limpar TODOS os caches antigos
      try {
        const cacheNames = await caches.keys();
        console.log('üì¶ Caches encontrados:', cacheNames);
        
        for (const name of cacheNames) {
          if (name !== 'ambiente-espiritual-v4') {
            console.log('üóëÔ∏è Deletando cache:', name);
            await caches.delete(name);
          }
        }
        console.log('‚úÖ Todos os caches antigos removidos!');
      } catch (error) {
        console.error('‚ùå Erro ao limpar cache:', error);
      }
      
      // 2. Limpar localStorage desatualizado
      try {
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          // Manter apenas o checklist moderno
          if (key !== 'ambiente-espiritual-checklist') {
            keysToRemove.push(key);
          }
        }
        
        keysToRemove.forEach(key => {
          console.log('üóëÔ∏è Removendo localStorage:', key);
          localStorage.removeItem(key);
        });
        
        if (keysToRemove.length > 0) {
          console.log('‚úÖ localStorage limpo:', keysToRemove.length, 'itens removidos');
        }
      } catch (error) {
        console.error('‚ùå Erro ao limpar localStorage:', error);
      }
      
      // 3. Limpar IndexedDB (se existir de vers√µes antigas)
      try {
        if (window.indexedDB) {
          const dbs = await indexedDB.databases?.() || [];
          dbs.forEach(db => {
            if (db.name.includes('ambiente')) {
              indexedDB.deleteDatabase(db.name);
              console.log('üóëÔ∏è Deletando IndexedDB:', db.name);
            }
          });
        }
      } catch (error) {
        console.log('‚ÑπÔ∏è IndexedDB cleanup n√£o ativado:', error.message);
      }
      
      console.log('‚ú® == LIMPEZA v4 CONCLU√çDA == ‚ú®');
    })();

    // Registrar Service Worker com verifica√ß√£o de atualiza√ß√£o
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.addEventListener('message', (event) => {
        if (event.data.type === 'CACHE_CLEARED') {
          console.log('üì¢ Service Worker:', event.data.message);
        }
      });
      
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => {
            console.log('‚úÖ Service Worker v4 registrado');
            
            // Verificar atualiza√ß√µes a cada 1 minuto (em vez de 5)
            setInterval(() => {
              console.log('üîÑ Verificando atualiza√ß√µes...');
              reg.update();
            }, 1 * 60 * 1000);
            
            // Atualizar imediatamente ao carregar
            reg.update();
          })
          .catch(err => console.error('‚ùå Erro no Service Worker:', err));
      });
    }
  </script>
</body>
</html>
<button class="glass-button text-white font-medium py-3 rounded-xl flex flex-col items-center justify-center gap-2 active:scale-95 transition-transform duration-200 hover:bg-white/20" onclick="window.location='./checklist.html'">
<span class="material-symbols-outlined text-[var(--gold-light)]">checklist</span>
<span class="text-sm">Checklist</span>
</button>
<button class="glass-button text-white font-medium py-3 rounded-xl flex flex-col items-center justify-center gap-2 active:scale-95 transition-transform duration-200 hover:bg-white/20" onclick="window.location='./wallpapers.html'">
<span class="material-symbols-outlined text-[var(--gold-light)]">image</span>
<span class="text-sm">Wallpapers</span>
</button>
</div>
<div class="flex gap-2 text-[var(--gold-light)] opacity-60">
<span class="w-2 h-2 rounded-full bg-current"></span>
<span class="w-2 h-2 rounded-full bg-gray-600"></span>
<span class="w-2 h-2 rounded-full bg-gray-600"></span>
<span class="w-2 h-2 rounded-full bg-gray-600"></span>
<span class="w-2 h-2 rounded-full bg-gray-600"></span>
</div>
</div>
</main>
<script>
  // üßπ LIMPEZA AGRESSIVA: Remover cache antigo e localStorage desatualizado
  (async function clearOldCache() {
    try {
      // Listar todos os caches
      const cacheNames = await caches.keys();
      console.log('üì¶ Caches encontrados:', cacheNames);
      
      // Remover qualquer cache que n√£o seja v3
      const oldCaches = cacheNames.filter(name => 
        name.includes('ambiente-espiritual') && !name.includes('v3')
      );
      
      if (oldCaches.length > 0) {
        console.log('üßπ Limpando caches antigos:', oldCaches);
        await Promise.all(oldCaches.map(name => caches.delete(name)));
        console.log('‚úÖ Caches antigos removidos com sucesso!');
      }
    } catch (error) {
      console.error('Erro ao limpar cache:', error);
    }
    
    // Limpar localStorage de vers√µes anteriores
    try {
      // Manter apenas o checklist moderno
      const allKeys = Object.keys(localStorage);
      const keysToKeep = ['ambiente-espiritual-checklist'];
      
      allKeys.forEach(key => {
        if (!keysToKeep.includes(key) && key.includes('ambiente') || key.includes('checklist')) {
          console.log('üßπ Removendo localStorage:', key);
          localStorage.removeItem(key);
        }
      });
    } catch (error) {
      console.error('Erro ao limpar localStorage:', error);
    }
  })();

  // Notificar quando Service Worker envia mensagem de limpeza
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.addEventListener('message', (event) => {
      if (event.data.type === 'CACHE_CLEARED') {
        console.log('‚ú® Service Worker:', event.data.message);
        // Recarregar a p√°gina para aplicar mudan√ßas
        if (confirm('App foi atualizado! Deseja recarregar a p√°gina?')) {
          location.reload();
        }
      }
    });
  }
  
  // Registrar Service Worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('./service-worker.js')
        .then(reg => {
          console.log('‚úÖ Service Worker registrado:', reg.scope);
          
          // Verificar atualiza√ß√µes a cada 5 minutos
          setInterval(() => {
            reg.update();
          }, 5 * 60 * 1000);
        })
        .catch(err => console.error('‚ùå Erro no Service Worker:', err));
    });
  }
</script>
</body></html>
